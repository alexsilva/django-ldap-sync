<button type="button" class="btn btn-secondary" id="btn-ldap-migration" title="Migra o usuários sem conta para esta">
    <span class=""></span>
    Migração de usuários
</button>
<script type="application/javascript">
    $(function () {
        $("#btn-ldap-migration").click(function (evt) {
            var $btn = $(this),
                csrftoken = $.getCookie('csrftoken');
            if ($btn.prop("disabled")) {
                evt.preventDefault();
                evt.stopPropagation();
                return
            }
            $.ajax({
                url: "{{ ldap_migration_url }}",
                method: 'post',
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    $btn.find("span")
                        .removeClass("fa fa-check-circle text-success")
                        .addClass("fa-spinner fa fa-spin fa-large");
                    $btn.prop("disabled", true);
                }
            }).done(function (data) {
                console.log(data)

            }).always(function (){
                setTimeout(function (){
                    $btn.find("span")
                        .removeClass("fa-spinner fa fa-spin fa-large")
                        .addClass("fa fa-check-circle text-success");
                    $btn.prop("disabled", false);
                }, 2000);
            });
        });
    });
</script>